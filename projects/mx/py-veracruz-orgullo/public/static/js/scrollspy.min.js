;(function ($, window) {
    $.fn.extend({
        scrollspy: function (opts) {
            var win = $(window),
                options = {
                min: 0,
                max: win.height(),
                root: win,
                container: opts.container || null,
                element: opts.element || null,
                background: opts.background || null,
                shadow: opts.shadow || null
            };
            return this.each(function(i){
                var root = options.root,
                    container = options.container,
                    element = options.element,
                    background = options.background,
                    shadow = options.shadow,
                    position = 0;
                root.bind('scroll', function(e){
                    if(root.width()<979||element.height()<container.height()){return;}
                    position = root.scrollTop();
                    if(position > 0 && !container.hasClass('active')){container.addClass('active'); shadow.css('opacity', 1);}
                    else if(position <= 0 && container.hasClass('active')){container.removeClass('active'); shadow.css('opacity', 0);}
                    pos_root = (position*100)/(background.height()-root.height());
                    pos_element = ((element.height()-container.height())*pos_root)/100;
                    element.css('top', -pos_element);
                }).bind('resize', function(e){
                    if(element.height()<container.height()){
                        element.css('top', 0);
                        container.removeClass('active');
                        shadow.css('opacity', 0);
                    }
                });
            });
        }
    });
})(jQuery, window);